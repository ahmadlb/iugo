<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="qunit.css">  
<script type="text/javascript" src="qunit.js"></script>
<script src="../iugo.js"></script>
<script src="../iugo-bind_by_class.js"></script>
<script>
window.onload = function() {
	var testCase = new Iugo({
		email: "chris@factmint.com",
		friends: [
			{firstname: "Euan", surname: "Holloway", age: 29},
			{firstname: "Josie", surname: "Capell", age: 29},
			{firstname: "Alex", surname: "Parkes", age: 30}
		],
		contact: {
			telephone: "999",
			address: {
				city: "London",
				country: "UK",
				postcode: "N3 4DD"
			}
		},
		work: {
			telephone: "911",
			address: {
				city: "New York"
			}
		},
		websites: ["factmint.com", "chrisscott.org", "iugojs.com"]
	},
	
	document.getElementById("testView"));
	
	test('Simple Member Test', function() {
		var email = document.getElementById('simpleMemberTest');
		equal(email.innerHTML, "chris@factmint.com", "Simple Member bound by class");
		testCase.email = "chris.scott@factmint.com";
		equal(email.innerHTML, "chris.scott@factmint.com", "Updates to the model are reflected in the DOM");
	});
	
	test('Object Member Test', function() {
		var city = document.getElementById('objectMemberTest');
		equal(city.innerHTML, "London", "Object Member bound by class and key");
	});
	
	test('Object Binding Test', function() {
		var emptyObject = document.getElementById('objectFalseTest');
		equal(emptyObject.innerHTML, "", "No content is bound at the top level of an object");
		
		var myTelephone = document.getElementById('objectMemberChildElementTest');
		equal(myTelephone.innerHTML, "999", "Child elements are bound to members");
		
		var postcode = document.getElementById('variableSyntaxTest').children[0];
		ok(postcode, "Variables are substituted for nodes");
		equal(postcode.tagName, "SPAN", "Variables are substituted for <span> tags");
		equal(postcode.attributes[0].name, "data-bind_key", "Variable span tags have a bind key");
		equal(postcode.attributes[0].value, "address.postcode", "The variable's bind key is set correctly");
		equal(postcode.innerHTML, "N3 4DD", "The variable span tag is bound to a member");
		
		var workCity = document.getElementById('variableSyntaxNamespaceTest').children[0];
		ok(workCity, "Namespaced variables are substituted for nodes");
		ok(workCity.className.match("bindto-work"), "The namespaced variable's span is bound to a top-level model");
		equal(workCity.innerHTML, "New York", "The namespaces variable span tag is bound to a member");
		
		var workTelephone = document.getElementById('variableSyntaxNamespaceTest').children[1];
		ok(workTelephone, "Multiple variables are all sumstituted");
		equal(workTelephone.innerHTML, "911", "The second namespaces variable tag is bound to a member");
		
		var email = document.getElementById('variableSyntaxNamespaceOnlyTest').children[0];
		ok(email, "A variable with a namespace and no address is still bound to a simple variable");
		equal(email.innerHTML, "chris.scott@factmint.com", "The simple variable is adressed by namespace alone");
	});
	
	test('Simple List Binding Test', function() {
		var list = document.getElementById('simpleListTest').children;
		equal(list.length, 3, "Each element for a list is bound by the data-bind_each attribute");
		ok(list[0].innerHTML == "factmint.com" && list[1].innerHTML == "chrisscott.org" && list[2].innerHTML == "iugojs.com", "All elements from the list are bound correctly");
		
		testCase.websites.reverse();
		var list = document.getElementById('simpleListTest').children;
		ok(list[0].innerHTML == "iugojs.com" && list[1].innerHTML == "chrisscott.org" && list[2].innerHTML == "factmint.com", "All elements from the list are bound correctly after the array is reversed");
		
		testCase.websites.push("foodyfare.com");
		var list = document.getElementById('simpleListTest').children;
		equal(list.length, 4, "Elements can be pushed onto the array in the model");
		equal(list[3].innerHTML, "foodyfare.com", "Changes to the array are mapped to the DOM");
		
		testCase.websites.sort();
		var list = document.getElementById('simpleListTest').children;
		ok(list[0].innerHTML == "chrisscott.org" && list[1].innerHTML == "factmint.com" && list[2].innerHTML == "foodyfare.com" && list[3].innerHTML == "iugojs.com", "All elements from the list are bound correctly after the array is sorted");
		
		testCase.websites.splice(1, 2, "google.com");
		var list = document.getElementById('simpleListTest').children;
		ok(list[0].innerHTML == "chrisscott.org" && list[1].innerHTML == "google.com" && list[2].innerHTML == "iugojs.com", "All elements from the list are bound correctly after the array is spliced");
		
		testCase.websites.unshift("factmint.com");
		var list = document.getElementById('simpleListTest').children;
		ok(list[0].innerHTML == "factmint.com" && list[1].innerHTML == "chrisscott.org" && list[2].innerHTML == "google.com" && list[3].innerHTML == "iugojs.com", "All elements from the list are bound correctly after an element is unshifted");
		
		testCase.websites.pop();
		var list = document.getElementById('simpleListTest').children;
		ok(list[0].innerHTML == "factmint.com" && list[1].innerHTML == "chrisscott.org" && list[2].innerHTML == "google.com", "All elements from the list are bound correctly after an element is popped");
		
		testCase.websites.shift();
		var list = document.getElementById('simpleListTest').children;
		ok(list[0].innerHTML == "chrisscott.org" && list[1].innerHTML == "google.com", "All elements from the list are bound correctly after an element is shifted");
	});
	
	test('Object List Test', function() {
		var friendList = document.getElementById('objectListTest').children;
		equal(friendList.length, 3, "All of the objects from the list are repeated in the DOM");
		ok(friendList[0].innerHTML == "Euan" && friendList[1].innerHTML == "Josie" && friendList[2].innerHTML == "Alex", "All values from the objects are mapped to the appropriate bind key");
		
		var deepFriendsList = document.getElementById('objectDeepListTest').children;
		equal(deepFriendsList.length, 3, "All of the objects from the list are repeated as child DOM trees");
		var alex = deepFriendsList[2].children;
		ok(alex[0].innerHTML == "Alex" && alex[1].innerHTML == "Parkes", "The child nodes with bind keys have been mapped");
		equal(alex.length, 3, "The variable syntax has been added to the child DOM tree");
		equal(alex[2].attributes[0].name, "data-bind_key", "A bind key has been added to the variable syntax span");
		equal(alex[2].attributes[0].value, "age", "The bind key has been set successfully from the variable syntax");
		equal(alex[2].innerHTML, "30", "The variable syntax span has been mapped correctly");
	});
	
	test('Attribute Binding Test', function() {
		var city = document.getElementById('attributeBindTest');
		equal(city.getAttribute("data-iugo_original_data-country"), "${address.country}", "The original variable is stored");
		equal(city.getAttribute("data-country"), "UK", "The value is used to populate the attribute");
		
		var pic = document.getElementById('attributeInjectMemberTest');
		equal(pic.getAttribute("src"), "images/country/UK", "The value is injected into the attribute in the place of a variable");
		
		testCase.contact.address.country = "England";
		equal(city.getAttribute("data-country"), "England", "Changes to the model are updated in the attribute");
		equal(pic.getAttribute("src"), "images/country/England", "Changes to the model are injected into the attribute in the place of a variable");
		
		var alex = document.getElementById('attributesListTest').children[2].children[0];
		equal(alex.getAttribute("data-name"), "Alex Parkes", "Attribute bindings work from a list");
		
		var workTelephone = document.getElementById('attributeBindNamespaceTest');
		equal(workTelephone.getAttribute("data-phone"), "911", "Namespaced variables in attributes are substituted properly");
	});
};
</script>
<style>
	#testView {
		display: none;
	}
</style>
</head>
<body>
	<div id="testView">
		<span class="bindto-email" id="simpleMemberTest"></span>
		<span class="bindto-contact" data-bind_key="address.city" id="objectMemberTest"></span>
		<div class="bindto-contact" id="objectFalseTest"></div>
		<div class="bindto-contact">
			<span data-bind_key="telephone" id="objectMemberChildElementTest"></span>
			<span id="variableSyntaxTest">My post code is ${address.postcode}.</span>
			<span id="variableSyntaxNamespaceTest">In ${work:address.city} the Emergency Serives are on ${work:telephone}</span>
			<span id="variableSyntaxNamespaceOnlyTest">My email is ${email:}</span>
		</div>
		<ul class="bindto-websites" id="simpleListTest">
			<li data-bind_each></li>
		</ul>
		<ul class="bindto-friends" id="objectListTest">
			<li data-bind_each data-bind_key="firstname"></li>
		</ul>
		<ul class="bindto-friends" id="objectDeepListTest">
			<li data-bind_each>
				<span data-bind_key="firstname"></span>
				<span data-bind_key="surname"></span>
				is ${age} years old
			</li>
		</ul>
		<div class="bindto-contact" data-bind_attribute="data-country" data-country="${address.country}" id="attributeBindTest">
			<img data-bind_attribute="src" src="images/country/${address.country}" id="attributeInjectMemberTest"></img>
			<ul class="bindto-friends" id="attributesListTest">
				<li data-bind_each><p data-bind_attribute="data-name" data-name="${firstname} ${surname}"></p></li>
			</ul>
			<div data-bind_attribute="data-phone" data-phone="${work:telephone}" id="attributeBindNamespaceTest"></div>
		</div>
	</div>
	<h1 id="qunit-header">iugo MVVC test coverage</h1>  
	<h2 id="qunit-banner"></h2>  
	<div id="qunit-testrunner-toolbar"></div>  
	<h2 id="qunit-userAgent"></h2>  
	<ol id="qunit-tests"></ol>
</body>
</html>