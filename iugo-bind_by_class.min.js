/* Author Chris Scott, MIT license */
$iugo.$internals.MVVC.prototype.initializers.push(function(c){for(var g=/(>[^<$]*)\$\{([^.}<]+)\.?([^}<]*)\}([^<]*<)/g;c.innerHTML.match(g);)c.innerHTML=c.innerHTML.replace(g,'$1<span class="bindto-$2" data-bind_key="$3"></span>$4')}); $iugo.$internals.MVVC.prototype.defaultViewcontrollers.push(function(c,g,e){function h(f,b,c){if(b.hasAttribute("data-bind_attribute")){var a=b.getAttribute("data-bind_attribute");b.hasAttribute("data-iugo_original_"+a)||b.setAttribute("data-iugo_original_"+a,b.getAttribute(a));var d=b.getAttribute("data-iugo_original_"+a).replace(k,function(a,c){for(var b=c.split("."),d=f,e=0;e<b.length;e++)d=d[b[e]];return d});b.setAttribute(a,d)}if(f instanceof Array){c=b.children.length;for(a=0;a<c;a++)if(b.children[a].hasAttribute("data-bind_each")){d= b.children[a];0==f.length?(d.setAttribute("data-iugo_display",d.style.display),d.style.display="none"):d.style.display=d.getAttribute("data-iugo_display");for(var e=0;e<f.length;e++)1<=e&&(d=d.cloneNode(!0),d.className+=" iugo_cloned",b.appendChild(d)),h(f[e],d)}}else if(f instanceof Object){a=b.getAttribute("data-bind_key");null!=a&&""!=a&&(c=null==c?"":c+".",a=a.slice(c.length).split(".")[0],h(f[a],b,c+a));for(a=0;a<b.children.length;a++)h(f,b.children[a],c)}else"INPUT"==b.tagName?b.value=f:b.innerHTML= f}for(var k=/\$\{([^}]+)\}/g,c=e.getElementsByClassName("bindto-"+c),e=0;e<c.length;e++){for(var i=c[e].getElementsByClassName("iugo_cloned"),l=i.length,j=0;j<l;j++)i[0].parentNode.removeChild(i[0]);h(g,c[e])}});