/* Author Chris Scott, MIT license */
$iugo.$internals.MVVC.prototype.initializers.push(function(b){for(var h=/(>[^<$]*)\$\{([^.}<]+)\.?([^}<]*)\}([^<]*<)/g;b.innerHTML.match(h);)b.innerHTML=b.innerHTML.replace(h,'$1<span class="bindto-$2" data-bind_key="$3"></span>$4')}); $iugo.$internals.MVVC.prototype.defaultViewcontrollers.push(function(b,h,g){function i(f,a,b){if(a.hasAttribute("data-bind_attribute"))for(var c=a.getAttribute("data-bind_attribute").split(" "),d=0;d<c.length;d++){var e=c[d];a.hasAttribute("data-iugo_original_"+e)||a.setAttribute("data-iugo_original_"+e,a.getAttribute(e));var g=a.getAttribute("data-iugo_original_"+e).replace(l,function(b,a){for(var d=a.split("."),c=f,e=0;e<d.length;e++)c=c[d[e]];return c});a.setAttribute(e,g)}if(f instanceof Array){b= a.children.length;for(d=0;d<b;d++)if(a.children[d].hasAttribute("data-bind_each")){c=a.children[d];0==f.length?(c.setAttribute("data-iugo_display",c.style.display),c.style.display="none"):c.style.display=c.getAttribute("data-iugo_display");for(e=0;e<f.length;e++)1<=e&&(c=c.cloneNode(!0),c.className+=" iugo_cloned",a.appendChild(c)),i(f[e],c)}}else if(f instanceof Object){e=a.getAttribute("data-bind_key");null!=e&&""!=e&&(b=null==b?"":b+".",d=e.slice(b.length).split(".")[0],i(f[d],a,b+d));for(d=0;d< a.children.length;d++)i(f,a.children[d],b)}else"INPUT"==a.tagName?a.value=f:a.innerHTML=f}for(var l=/\$\{([^}]+)\}/g,b=g.getElementsByClassName("bindto-"+b),g=0;g<b.length;g++){for(var j=b[g].getElementsByClassName("iugo_cloned"),m=j.length,k=0;k<m;k++)j[0].parentNode.removeChild(j[0]);i(h,b[g])}});