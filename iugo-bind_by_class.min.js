/* Author Chris Scott, MIT license */
$iugo.store.VC={a:[],b:{}};$iugo.initializers.push(function(a){for(var l=0,h=/(>[^<$]*)\$\{([^:.}<]+:)?([^}<]*)\}([^<]*<)/g;a.innerHTML.match(h);)a.innerHTML=a.innerHTML.replace(h,function(j,e,a,g,b){j=e+"<span ";a&&(j+='class="bindto-'+a.substr(0,a.length-1)+'" ');return j+('data-bind_key="'+g+'"></span>'+b)});a.innerHTML=a.innerHTML.replace(/<[^>]+ [^ =]+="[^"]*\$\{[^}<"]+\}[^"]*"[^>]*>/g,function(a){var e=l++;$iugo.store.VC.a[e]={d:[],c:{},e:{}};a=a.replace(/([^ =]+)="([^"]*\$\{[^}"]+\}[^"]*)"/g,function(a,g,b){$iugo.store.VC.a[e].d.push(g);$iugo.store.VC.a[e].c[g]=b;b.replace(/\$\{([^"}:]+):[^}"]+\}/g,function(a,b){$iugo.store.VC.b[b]||($iugo.store.VC.b[b]=[]);-1==$iugo.store.VC.b[b].indexOf(e)&&$iugo.store.VC.b[b].push(e)});return g+'=""'});return a=a.replace(/ ?>$/,' data-iugo_id="'+e+'">')})});$iugo.defaultViewcontrollers.push(function(a,l,h){function j(a,c,b){if(c.hasAttribute("data-iugo_id")){var d=c.getAttribute("data-iugo_id");c=$iugo.store.VC.a[d].d;for(var f=0;f<c.length;f++)$iugo.store.VC.a[d].c[c[f]].replace(n,function(c,e,f){if(!e&&!b||e&&e.substr(0,e.length-1)==b){e=f.split(".");f=a;for(var g=0;g<e.length;g++)f=f[e[g]];$iugo.store.VC.a[d].e[c]=f}});c=document.querySelector('[data-iugo_id="'+d+'"]');for(var f=$iugo.store.VC.a[d].d,e=0;e<f.length;e++){var g=$iugo.store.VC.a[d].c[f[e]].replace(n,function(c){return $iugo.store.VC.a[d].e[c]?$iugo.store.VC.a[d].e[c]:""});c.setAttribute(f[e],g)}}}function e(a,c,b){j(a,c);if(a instanceof Array){b=c.children.length;for(var d=b-1;0<=d;d--)c.children[d].classList.contains("iugo_cloned")&&c.removeChild(c.children[d]);b=c.children.length;for(d=0;d<b;d++){var f;if(c.children[d].hasAttribute("data-bind_each")){f=c.children[d];0==a.length?(f.setAttribute("data-iugo_display",f.style.display),f.style.display="none"):f.style.display=f.getAttribute("data-iugo_display");for(var g=0;g<a.length;g++){var h;1<=g?(h=f.cloneNode(!0),h.classList.add("iugo_cloned"),c.appendChild(h)):h=f;e(a[g],h)}}}}else if(a instanceof Object){d=c.getAttribute("data-bind_key");null!=d&&""!=d&&(b=null==b?"":b+".",d=d.slice(b.length).split(".")[0],e(a[d],c,b+d));for(d=0;d<c.children.length;d++)c.children[d].className.match("bindto-")||e(a,c.children[d],b)}else"INPUT"==c.tagName?c.value=a:c.innerHTML=a}var n=/\$\{([^:}]+:)?([^}]+)\}/g;if($iugo.store.VC.b[a])for(var g=$iugo.store.VC.b[a],b=0;b<g.length;b++)for(var k=h.querySelectorAll('[data-iugo_id="'+g[b]+'"]'),m=0;m<k.length;m++)j(l,k[m],a);k=h.getElementsByClassName("bindto-"+a);for(b=0;b<k.length;b++)e(l,k[b])});