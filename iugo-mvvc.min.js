/* Author Chris Scott, MIT license */
window.$iugo={};$iugo.$i={};$iugo.$i.registerModelMember=function(a,b){Object.defineProperty(a,b,{get:function(){return this.$[b]},set:function(a){this.updateView(b,a);this.$[b]=a;$iugo.$i.applySetters(a,this,[b],a)}})}; $iugo.$i.applySetters=function(a,b,c,f){if(a instanceof Object||a instanceof Array){for(var d in a){$iugo.$i.registerProperty(a,d,b,c);var e=c.concat([d]);$iugo.$i.applySetters(a[d],b,e,f)}a instanceof Array&&$iugo.$i.registerArray(a,b,c)}}; $iugo.$i.registerProperty=function(a,b,c,f){c.$[f.concat([b]).join(".")]=a[b];a.__defineSetter__(b,function(d){c.$[f.concat([b]).join(".")]=d;$iugo.$i.setChildMembers(a,c,f);c.updateView(f[0],c[f[0]])});a.__defineGetter__(b,function(){return c.$[f.concat([b]).join(".")]})};$iugo.$i.setChildMembers=function(a,b,c){if(a instanceof Object||a instanceof Array)for(var f in a){var d=c.concat([f]);b.$[d.join(".")]=a[f];$iugo.$i.setChildMembers(a[f],b,d)}}; $iugo.$i.registerArray=function(a,b,c){a.push=function(){var a=Array.prototype.push.apply(this,arguments);b[c[0]]=b[c[0]];return a};a.pop=function(){var f=$iugo.$i.clone(Array.prototype.pop.call(a));b[c[0]]=b[c[0]];return f};a.unshift=function(){for(var a=$iugo.$i.clone(this),d=0;d<arguments.length;d++)this[d]=arguments[d];for(var e=0;e<a.length;e++)this[d++]=a[e];b[c[0]]=b[c[0]];return this.length};a.shift=function(){var a=$iugo.$i.clone(Array.prototype.shift.call(this)); b[c[0]]=b[c[0]];return a};a.reverse=function(){for(var a=$iugo.$i.clone(this),b=0;b<this.length;b++)this[b]=a[this.length-1-b];return this};a.sort=function(){var a=$iugo.$i.clone(this);Array.prototype.sort.apply(a,arguments);for(var b=0;b<this.length;b++)this[b]=a[b];return this};a.splice=function(){for(var a=$iugo.$i.clone(this),d=0;d<a.length,d<arguments[0];d++)this[d]=a[d];for(var e=2;e<arguments.length;e++)this[d++]=arguments[e];for(e=arguments[0]+arguments[1];e<a.length;e++)this[d++]= a[e];for(e=d;e<a.length;e++)this.pop();b[c[0]]=b[c[0]];return this}};$iugo.$i.clone=function(a){var b;b=a instanceof Array?[]:{};for(var c in a)b[c]=a[c]instanceof Object||a[c]instanceof Array?$iugo.$i.clone(a[c]):a[c];return b};$iugo.$i.MVVC=function(a,b,c){this.view=b?b:document.body;this.viewcontroller=c?c:{};for(b=0;b<this.initializers.length;b++)if(this.initializers[b]instanceof Function)this.initializers[b](this.view);this.model=a}; $iugo.$i.MVVC.prototype={$:{},set model(a){for(var b in a)$iugo.$i.registerModelMember(this,b),this[b]=a[b]},updateView:function(a,b){for(var c=0;c<this.defaultViewcontrollers.length;c++)if(this.defaultViewcontrollers[c]instanceof Function)this.defaultViewcontrollers[c](a,b,this.view);if("undefined"!==typeof this.viewcontroller[a]&&this.viewcontroller[a]instanceof Function)this.viewcontroller[a](b,this.view)},defaultViewcontrollers:[],initializers:[]}; window.Iugo=function(a,b,c){return new $iugo.$i.MVVC(a,b,c)};
$iugo.$i.MVVC.prototype.initializers.push(function(b){for(var h=/(>[^<$]*)\$\{([^.}<]+)\.?([^}<]*)\}([^<]*<)/g;b.innerHTML.match(h);)b.innerHTML=b.innerHTML.replace(h,'$1<span class="bindto-$2" data-bind_key="$3"></span>$4')}); $iugo.$i.MVVC.prototype.defaultViewcontrollers.push(function(b,h,g){function i(f,a,b){if(a.hasAttribute("data-bind_attribute"))for(var c=a.getAttribute("data-bind_attribute").split(" "),d=0;d<c.length;d++){var e=c[d];a.hasAttribute("data-iugo_original_"+e)||a.setAttribute("data-iugo_original_"+e,a.getAttribute(e));var g=a.getAttribute("data-iugo_original_"+e).replace(l,function(b,a){for(var d=a.split("."),c=f,e=0;e<d.length;e++)c=c[d[e]];return c});a.setAttribute(e,g)}if(f instanceof Array){b= a.children.length;for(d=0;d<b;d++)if(a.children[d].hasAttribute("data-bind_each")){c=a.children[d];0==f.length?(c.setAttribute("data-iugo_display",c.style.display),c.style.display="none"):c.style.display=c.getAttribute("data-iugo_display");for(e=0;e<f.length;e++)1<=e&&(c=c.cloneNode(!0),c.className+=" iugo_cloned",a.appendChild(c)),i(f[e],c)}}else if(f instanceof Object){e=a.getAttribute("data-bind_key");null!=e&&""!=e&&(b=null==b?"":b+".",d=e.slice(b.length).split(".")[0],i(f[d],a,b+d));for(d=0;d< a.children.length;d++)i(f,a.children[d],b)}else"INPUT"==a.tagName?a.value=f:a.innerHTML=f}for(var l=/\$\{([^}]+)\}/g,b=g.getElementsByClassName("bindto-"+b),g=0;g<b.length;g++){for(var j=b[g].getElementsByClassName("iugo_cloned"),m=j.length,k=0;k<m;k++)j[0].parentNode.removeChild(j[0]);i(h,b[g])}});