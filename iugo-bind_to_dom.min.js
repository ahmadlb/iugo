/* Author Chris Scott, MIT license */
$iugo.store.bind_to_dom={a:[],b:{}};$iugo.initializers.push(function(a){for(var p=0,m=/(>[^<]*)\$\{([^:.}<]+:)?([^}<]*)\}([^<]*<)/g;a.innerHTML.match(m);)a.innerHTML=a.innerHTML.replace(m,function(k,f,a,b,h){k=f+"<span ";a&&(k+='class="bindto-'+a.substr(0,a.length-1)+'" ');return k+('data-bind_key="'+b+'"></span>'+h)});a.innerHTML=a.innerHTML.replace(/<[^>]+ [^ =]+="[^"]*\$\{[^}<"]+\}[^"]*"[^>]*>/g,function(a){var f=p++;$iugo.store.bind_to_dom.a[f]={d:[],c:{},e:{}};a=a.replace(/([^ =]+)="([^"]*\$\{[^}"]+\}[^"]*)"/g,function(a,b,h){"data-iugo_alias-"==b.substr(0,16)&&(b=b.substr(16));$iugo.store.bind_to_dom.a[f].d.push(b);$iugo.store.bind_to_dom.a[f].c[b]=h;h.replace(/\$\{([^"}:]+):[^}"]+\}/g,function(a,b){$iugo.store.bind_to_dom.b[b]||($iugo.store.bind_to_dom.b[b]=[]);-1==$iugo.store.bind_to_dom.b[b].indexOf(f)&&$iugo.store.bind_to_dom.b[b].push(f)});return b+'=""'});return a=a.replace(/ ?>$/,' data-iugo_id="'+f+'">')})});$iugo.defaultViewcontrollers.push(function(a,p,m){function k(a){for(var d=document.querySelector('[data-iugo_id="'+a+'"]'),l=$iugo.store.bind_to_dom.a[a].d,c=0;c<l.length;c++){var e=$iugo.store.bind_to_dom.a[a].c[l[c]].replace(b,function(c){return $iugo.store.bind_to_dom.a[a].e[c]?$iugo.store.bind_to_dom.a[a].e[c]:""});d.setAttribute(l[c],e)}}function f(a,d,l){if(d.hasAttribute("data-iugo_id")){var c=d.getAttribute("data-iugo_id");d=$iugo.store.bind_to_dom.a[c].d;for(var e=0;e<d.length;e++)$iugo.store.bind_to_dom.a[c].c[d[e]].replace(b,function(d,b,e){if(!b&&!l||b&&b.substr(0,b.length-1)==l){b=e.split(".");e=a;for(var f=0;f<b.length;f++)e=e[b[f]];$iugo.store.bind_to_dom.a[c].e[d]=e}});k(c)}}function q(a,d,b){f(a,d);if(a instanceof Array){b=d.children.length;for(var c=b-1;0<=c;c--)d.children[c].classList.contains("iugo_cloned")&&d.removeChild(d.children[c]);b=d.children.length;for(c=0;c<b;c++){var e;if(d.children[c].hasAttribute("data-bind_each")){e=d.children[c];0==a.length?(e.setAttribute("data-iugo_display",e.style.display),e.style.display="none"):e.style.display=e.getAttribute("data-iugo_display");for(var h=0;h<a.length;h++){var g;1<=h?(g=e.cloneNode(!0),g.classList.add("iugo_cloned"),d.appendChild(g)):g=e;q(a[h],g)}}}}else if(a instanceof Object)if(c=d.getAttribute("data-bind_key"),null!=c&&""!=c)b=null==b?"":b+".",c=c.slice(b.length).split(".")[0],q(a[c],d,b+c);else for(c=0;c<d.children.length;c++)d.children[c].className.match("bindto-")||q(a,d.children[c],b);else"INPUT"==d.tagName?d.value=a:d.innerHTML=a}var b=/\$\{([^:}]+:)?([^}]+)\}/g;if($iugo.store.bind_to_dom.b[a])for(var h=$iugo.store.bind_to_dom.b[a],g=0;g<h.length;g++)for(var n=m.querySelectorAll('[data-iugo_id="'+h[g]+'"]'),r=0;r<n.length;r++)f(p,n[r],a);n=m.getElementsByClassName("bindto-"+a);for(g=0;g<n.length;g++)q(p,n[g])});